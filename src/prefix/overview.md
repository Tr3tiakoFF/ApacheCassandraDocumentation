# Короткий огляд Apache Casandra

У цьому розділі наведено короткий огляд того, що собою уявляє та які переваги має Apache Casandra.

Для детального ознайомлення із тим, як влаштована Cassandra, прохання поглянути у довідковий посібник, починаючи із [архітектури Apache Cassandra](/body/reference_guide/architecture.md).

## Що таке Apache Cassandra?

***Cassandra*** - це розподілена NoSQL база даних з відкритим кодом.  
За задумом, NoSQL бази даних є легковаговими, нереляційними та здебільшого розподіленими.  
Серед їх основних переваг:
- Горизонтальна масштабованість
- Розподілені архітектури
- Гнучкий підхід до визначення схеми

NoSQL бази даних дозволяють швидко організовувати та аналізувати величезні обсяги різнорідних типів даних. Це стало особливо важливим в останні роки з появою Big Data та необхідністю швидко масштабувати бази даних у хмарі. Cassandra належить до NoSQL баз даних, які подолали обмеження попередніх технологій управління даними, таких як SQL-бази даних.

## Розподіленість забезпечує потужність і надійність

Однією з важливих характеристик Cassandra є її розподіленість. Це забезпечує як технічні, так і бізнесові переваги.  
Бази даних Cassandra легко масштабуються, коли на додаток припадає велике навантаження, а розподіленість також запобігає втраті даних у разі апаратного збою в будь-якому центрі обробки даних. Розподілена архітектура також забезпечує технічну потужність; наприклад, розробник може налаштовувати пропускну здатність запитів на читання або запис у режимі ізоляції.

*«Розподілена»* означає, що Cassandra може працювати на кількох машинах, але для користувачів виглядає як єдине ціле. Використання Cassandra як окремого вузла має мало сенсу, хоча це корисно для початкового ознайомлення з її роботою.  
Однак, щоб отримати максимальну вигоду від Cassandra, її потрібно запускати на кількох машинах.

Оскільки це розподілена база даних, Cassandra може (і зазвичай має) мати кілька вузлів.  
Вузол представляє собою один екземпляр Cassandra. Ці вузли взаємодіють між собою за допомогою протоколу, що називається «gossip» (поширення чуток) — це процес однорангового обміну інформацією між комп'ютерами.

Cassandra також має архітектуру без головного вузла: будь-який вузол у базі даних може виконувати ту саму функціональність, що й будь-який інший, що підвищує надійність і стійкість Cassandra. Кілька вузлів можуть бути організовані в логічний кластер або «кільце». Можна також мати декілька центрів обробки даних.

## Хочете більше потужності? Додавайте більше вузлів

Однією з причин популярності Cassandra є те, що вона дозволяє розробникам динамічно масштабувати бази даних, використовуючи стандартне апаратне забезпечення, без простоїв. Ви можете розширювати її за потреби - і так само зменшувати, якщо цього вимагають потреби додатка.

Можливо, ви звикли працювати з базами даних, такими як Oracle чи MySQL. У такому випадку вам відомо, що для розширення цих баз даних для підтримки більшої кількості користувачів або збільшення обсягу зберігання потрібно додати більше потужностей процесора, оперативної пам'яті чи швидші диски. Кожна з цих змін коштує чималих грошей. І все ж зрештою ви стикаєтеся з певними обмеженнями.

На відміну від цього, Cassandra дозволяє легко збільшувати обсяг даних, які вона може обробляти. Оскільки Cassandra базується на вузлах, вона масштабується горизонтально (також відомо як масштабування «в ширину»), використовуючи недороге стандартне обладнання. Щоб подвоїти потужність або пропускну здатність, просто подвоїть кількість вузлів. Ось і все. Потрібно більше потужності? Додавайте більше вузлів — хоч 8, хоч 8,000 — без простоїв. Ви також маєте можливість зменшити масштаб, якщо це потрібно.

Ця лінійна масштабованість практично не має меж. Ця можливість стала однією з ключових переваг Cassandra.

##  Введення до партицій

У Cassandra дані автоматично розподіляються, що позитивно впливає на продуктивність. Це досягається за допомогою партицій. Кожен вузол володіє певним набором токенів, а Cassandra розподіляє дані за діапазонами цих токенів у кластері. Ключ партиції відповідає за розподіл даних між вузлами та є важливим для визначення локальності даних. Коли дані додаються в кластер, першим кроком є застосування хеш-функції до ключа партиції. Вихідне значення використовується для визначення того, який вузол (відповідно до діапазону токенів) отримає дані.

Реплікація забезпечує надійність і відмовостійкість

Коли дані надходять, координатор бази даних бере на себе завдання призначити їх певній партиції – назвемо її партицією 59. Пам'ятайте, що будь-який вузол у кластері може виконувати роль координатора. Як було зазначено раніше, вузли «обмінюються чутками» між собою, під час чого вони комунікують про те, який вузол відповідає за певні діапазони токенів. Отже, в нашому прикладі координатор шукає: який вузол має токен 59? Коли він знаходить потрібний вузол, він пересилає туди дані. Вузол, який володіє даними для цього діапазону, називається вузлом-реплікою. Один фрагмент даних може бути реплікований на кілька (вузлів-реплік), що забезпечує надійність і відмовостійкість. На даний момент наші дані були репліковані тільки на одну репліку, що відповідає коефіцієнту реплікації один, або RF = 1.

Координатор не є окремим вузлом; система була б крихкою, якби це було так. Координатором є вузол, який отримує запит у конкретний момент часу. Будь-який вузол може виконувати роль координатора.

## Реплікація забезпечує надійність та відмовостійкість

Один фрагмент даних може бути реплікований на кілька вузлів-реплік, що забезпечує надійність і відмовостійкість. Cassandra підтримує поняття коефіцієнта реплікації (RF), який визначає, скільки копій ваших даних має існувати в базі даних. На даний момент наші дані були репліковані лише на одну репліку (RF = 1). Якщо ми збільшимо коефіцієнт реплікації до двох (RF = 2), дані потрібно буде зберігати на другій репліці, і кожен вузол стає відповідальним за вторинний діапазон токенів, додатково до свого основного діапазону. Коефіцієнт реплікації три забезпечує, що три вузли (репліки) покривають певний діапазон токенів, і дані зберігаються на ще одній репліці.

Розподілений характер Cassandra

Розподілений характер Cassandra робить її більш стійкою та продуктивною. Це особливо важливо, коли ми маємо кілька реплік для одних і тих самих даних. Такий підхід дозволяє системі самовідновлюватися, якщо щось іде не так, наприклад, якщо один із вузлів виходить з ладу, жорсткий диск пошкоджується або AWS перезапускає екземпляр. Реплікація забезпечує, що дані не будуть втрачені. Якщо надходить запит на дані, навіть якщо одна з реплік вийшла з ладу, інші дві залишаються доступними для виконання запиту. Координатор також зберігає «підказку» для цих даних, і коли недоступна репліка повертається, вона з’ясовує, що пропустила, і синхронізується з іншими двома репліками. Це відбувається автоматично, без необхідності втручання.

Використання кількох реплік також має переваги в продуктивності

Використання кількох реплік також має переваги в продуктивності. Оскільки ми не обмежені одним екземпляром, ми маємо три вузли (репліки), до яких можна звертатися для отримання даних для наших операцій, що дозволяє балансувати навантаження та досягати кращої продуктивності.

Cassandra автоматично реплікує дані між вашими різними центрами обробки даних. Ваш додаток може записувати дані на вузол Cassandra на західному узбережжі США, і ці дані автоматично стають доступними в центрах обробки даних на вузлах у Азії та Європі. Це має позитивні переваги для продуктивності — особливо, якщо ви підтримуєте користувачів у всьому світі. У світі, де залежність від хмарних обчислень і швидкого доступу до даних є високою, жоден користувач не страждає від затримок через віддаленість.

## Налаштування консистентності

Ми багато говорили про розподілені системи та доступність. Якщо ви знайомі з теоремою CAP, то знаєте, що за замовчуванням Cassandra є базою даних типу AP (доступна та стійка до поділу), тому вона завжди «вмикнена». Але ви можете налаштовувати консистентність для кожного запиту окремо. У цьому контексті рівень консистентності визначає мінімальну кількість вузлів Cassandra, які повинні підтвердити операцію читання або запису координатору, щоб операція вважалася успішною. Як загальне правило, ви обиратимете рівень консистентності (CL) на основі вашого коефіцієнта реплікації.

Для наведеного прикладу наші дані репліковані на трьох вузлах.  
Маємо CL = QUORUM (де «кворум» означає більшість, тобто в цьому випадку 2 репліки або RF / 2 + 1), тому координатор повинен отримати підтвердження від двох реплік, щоб запит вважався успішним.

Як і в інших обчислювальних завданнях, для оптимального налаштування цього параметра на потрібну продуктивність, доступність і цілісність даних може знадобитися певна майстерність. Але можливість управляти цим з такою точністю дає змогу детально контролювати розгортання.

## Cassandra не залежить від місця розгортання

Зрештою, Cassandra не залежить від місця розгортання. Їй байдуже, де саме ви її розміщуєте — у локальному середовищі, у хмарного провайдера чи навіть у кількох провайдерів одночасно. Ви можете комбінувати ці варіанти для однієї бази даних. Це дає розробникам програмного забезпечення максимальну гнучкість.