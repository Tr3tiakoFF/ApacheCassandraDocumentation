# Налаштування Apache Cassandra


Розташування файлів конфігурації Cassandra залежить від типу встановлення:

- Docker: `/etc/cassandra`
- Tarball: `conf` (у межах каталогу встановлення tarball)
- Package: `/etc/cassandra`

Файл конфігурації за замовчуванням, `cassandra.yaml`, підходить для дослідження простого однонодового кластера. Однак для запуску чогось складнішого, ніж однонодовий кластер локально, необхідна додаткова конфігурація інших файлів Cassandra. Наприклад, додаткова конфігурація потрібна для:

- Розгортання багатонодового кластера.
- Використання клієнтів, які не працюють на вузлах кластера.


## Основні конфігураційні файли

1. `cassandra.yaml`:  
   Основний файл конфігурації Cassandra.

2. `cassandra-env.sh`: 
   Використовується для налаштування змінних середовища.

3. `cassandra-rackdc.properties` або `cassandra-topology.properties`:  
   Використовуються для встановлення інформації про стійки (rack) та датацентри (datacenter) для кластера.

4. `logback.xml`:  
   Конфігурація логування, включаючи рівні логування.

5. `jvm-*`:  
   Набір файлів конфігурації JVM як для сервера, так і для клієнтів.

6. `commitlog_archiving.properties`:  
   Використовується для налаштування параметрів архівації commitlog.

### Приклади конфігураційних файлів

Зразки файлів конфігурації також доступні в каталозі `./conf`:

- `cqlshrc.sample`:  
  Демонструє, як можна налаштувати CQL Shell (`cqlsh`).

## Основні властивості середовища виконання

Налаштування Cassandra здійснюється через властивості у файлі `cassandra.yaml`. Мінімально рекомендується налаштувати такі параметри:

### Основні властивості:

- `cluster_name`:  
  Встановіть ім’я вашого кластера.

- `seeds`:  
  Список IP-адрес вузлів ініціалізації (seed nodes), розділених комами.

- `storage_port`:  
  Перевірте, чи порт за замовчуванням (7000) не блокується брандмауером.

- `listen_address`: 
  IP-адреса вузла для зв’язку з іншими вузлами кластера.  
  - За замовчуванням встановлено `localhost`.  
  - Можна замість цього використовувати `listen_interface`, щоб вказати, через який інтерфейс працювати.  
*Встановлюйте лише одну з властивостей, не обидві.*

- `native_transport_port`:  
  Перевірте, чи порт за замовчуванням (9042) не блокується брандмауером, щоб клієнти, такі як `cqlsh`, могли підключатися до Cassandra.

## Зміна розташування каталогів

Наступні властивості `yaml` контролюють розташування директорій:

- `data_file_directories`:  
  Один або більше каталогів, у яких зберігаються файли даних, наприклад, SSTables.

- `commitlog_directory`: 
  Каталог для файлів `commitlog`.

- `saved_caches_directory`:  
  Каталог для збережених кешів.

- `hints_directory`:  
  Каталог для збережених підказок (`hints`).

*Для підвищення продуктивності, якщо у вас є декілька дисків, розгляньте можливість розміщення `commitlog` та файлів даних на різних дисках.*


## Змінні середовища

Налаштування JVM, такі як розмір heap, задаються у файлі `cassandra-env.sh`.  
- Додаткові аргументи командного рядка JVM можна додати у змінну середовища `JVM_OPTS`.  
- Під час запуску Cassandra ці аргументи будуть передані JVM.

## Логування

За замовчуванням використовується логер `logback`. Його параметри:

- Рівень `INFO` у файлі `system.log`.
- Рівень `DEBUG` у файлі `debug.log`.
- Під час роботи у передньому плані також логування на рівні `INFO` виводиться у консоль.

### Зміна параметрів логування:
- Редагуйте файл `logback.xml`.
- Або використовуйте команду `nodetool setlogginglevel`.